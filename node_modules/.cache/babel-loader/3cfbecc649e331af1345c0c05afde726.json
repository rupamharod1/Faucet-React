{"ast":null,"code":"import { bytesToHex } from 'web3-utils';\nimport { setLengthLeft, toUint8Array } from '../common/utils.js';\nimport { isAccessList } from './types.js';\nexport const checkMaxInitCodeSize = (common, length) => {\n  const maxInitCodeSize = common.param('vm', 'maxInitCodeSize');\n\n  if (maxInitCodeSize && BigInt(length) > maxInitCodeSize) {\n    throw new Error(`the initcode size of this transaction is too large: it is ${length} while the max is ${common.param('vm', 'maxInitCodeSize')}`);\n  }\n};\nexport const getAccessListData = accessList => {\n  let AccessListJSON;\n  let uint8arrayAccessList;\n\n  if (isAccessList(accessList)) {\n    AccessListJSON = accessList;\n    const newAccessList = []; // eslint-disable-next-line @typescript-eslint/prefer-for-of\n\n    for (let i = 0; i < accessList.length; i += 1) {\n      const item = accessList[i];\n      const addressBytes = toUint8Array(item.address);\n      const storageItems = []; // eslint-disable-next-line @typescript-eslint/prefer-for-of\n\n      for (let index = 0; index < item.storageKeys.length; index += 1) {\n        storageItems.push(toUint8Array(item.storageKeys[index]));\n      }\n\n      newAccessList.push([addressBytes, storageItems]);\n    }\n\n    uint8arrayAccessList = newAccessList;\n  } else {\n    uint8arrayAccessList = accessList !== null && accessList !== void 0 ? accessList : []; // build the JSON\n\n    const json = []; // eslint-disable-next-line @typescript-eslint/prefer-for-of\n\n    for (let i = 0; i < uint8arrayAccessList.length; i += 1) {\n      const data = uint8arrayAccessList[i];\n      const address = bytesToHex(data[0]);\n      const storageKeys = []; // eslint-disable-next-line @typescript-eslint/prefer-for-of\n\n      for (let item = 0; item < data[1].length; item += 1) {\n        storageKeys.push(bytesToHex(data[1][item]));\n      }\n\n      const jsonItem = {\n        address,\n        storageKeys\n      };\n      json.push(jsonItem);\n    }\n\n    AccessListJSON = json;\n  }\n\n  return {\n    AccessListJSON,\n    accessList: uint8arrayAccessList\n  };\n};\nexport const verifyAccessList = accessList => {\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (let key = 0; key < accessList.length; key += 1) {\n    const accessListItem = accessList[key];\n    const address = accessListItem[0];\n    const storageSlots = accessListItem[1]; // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n\n    if (accessListItem[2] !== undefined) {\n      throw new Error('Access list item cannot have 3 elements. It can only have an address, and an array of storage slots.');\n    }\n\n    if (address.length !== 20) {\n      throw new Error('Invalid EIP-2930 transaction: address length should be 20 bytes');\n    } // eslint-disable-next-line @typescript-eslint/prefer-for-of\n\n\n    for (let storageSlot = 0; storageSlot < storageSlots.length; storageSlot += 1) {\n      if (storageSlots[storageSlot].length !== 32) {\n        throw new Error('Invalid EIP-2930 transaction: storage slot length should be 32 bytes');\n      }\n    }\n  }\n};\nexport const getAccessListJSON = accessList => {\n  const accessListJSON = []; // eslint-disable-next-line @typescript-eslint/prefer-for-of\n\n  for (let index = 0; index < accessList.length; index += 1) {\n    const item = accessList[index];\n    const JSONItem = {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n      address: bytesToHex(setLengthLeft(item[0], 20)),\n      storageKeys: []\n    }; // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-assignment, @typescript-eslint/prefer-optional-chain\n\n    const storageSlots = item && item[1]; // eslint-disable-next-line @typescript-eslint/prefer-for-of\n\n    for (let slot = 0; slot < storageSlots.length; slot += 1) {\n      const storageSlot = storageSlots[slot];\n      JSONItem.storageKeys.push(bytesToHex(setLengthLeft(storageSlot, 32)));\n    }\n\n    accessListJSON.push(JSONItem);\n  }\n\n  return accessListJSON;\n};\nexport const getDataFeeEIP2930 = (accessList, common) => {\n  const accessListStorageKeyCost = common.param('gasPrices', 'accessListStorageKeyCost');\n  const accessListAddressCost = common.param('gasPrices', 'accessListAddressCost');\n  let slots = 0; // eslint-disable-next-line @typescript-eslint/prefer-for-of\n\n  for (let index = 0; index < accessList.length; index += 1) {\n    const item = accessList[index];\n    const storageSlots = item[1];\n    slots += storageSlots.length;\n  }\n\n  const addresses = accessList.length;\n  return addresses * Number(accessListAddressCost) + slots * Number(accessListStorageKeyCost);\n};","map":{"version":3,"mappings":"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","names":["bytesToHex","setLengthLeft","toUint8Array","isAccessList","checkMaxInitCodeSize","common","length","maxInitCodeSize","param","BigInt","Error","getAccessListData","accessList","AccessListJSON","uint8arrayAccessList","newAccessList","i","item","addressBytes","address","storageItems","index","storageKeys","push","json","data","jsonItem","verifyAccessList","key","accessListItem","storageSlots","undefined","storageSlot","getAccessListJSON","accessListJSON","JSONItem","slot","getDataFeeEIP2930","accessListStorageKeyCost","accessListAddressCost","slots","addresses","Number"],"sources":["/home/rupam/Desktop/Faucet-React/node_modules/web3-eth-accounts/src/tx/utils.ts"],"sourcesContent":["/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nimport { HexString } from 'web3-types';\nimport { bytesToHex } from 'web3-utils';\nimport { setLengthLeft, toUint8Array } from '../common/utils.js';\nimport type { AccessList, AccessListUint8Array, AccessListItem } from './types.js';\nimport { isAccessList } from './types.js';\n\nimport type { Common } from '../common/common.js';\n\nexport const checkMaxInitCodeSize = (common: Common, length: number) => {\n\tconst maxInitCodeSize = common.param('vm', 'maxInitCodeSize');\n\tif (maxInitCodeSize && BigInt(length) > maxInitCodeSize) {\n\t\tthrow new Error(\n\t\t\t`the initcode size of this transaction is too large: it is ${length} while the max is ${common.param(\n\t\t\t\t'vm',\n\t\t\t\t'maxInitCodeSize',\n\t\t\t)}`,\n\t\t);\n\t}\n};\n\nexport const getAccessListData = (accessList: AccessListUint8Array | AccessList) => {\n\tlet AccessListJSON;\n\tlet uint8arrayAccessList;\n\tif (isAccessList(accessList)) {\n\t\tAccessListJSON = accessList;\n\t\tconst newAccessList: AccessListUint8Array = [];\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let i = 0; i < accessList.length; i += 1) {\n\t\t\tconst item: AccessListItem = accessList[i];\n\t\t\tconst addressBytes = toUint8Array(item.address);\n\t\t\tconst storageItems: Uint8Array[] = [];\n\t\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\t\tfor (let index = 0; index < item.storageKeys.length; index += 1) {\n\t\t\t\tstorageItems.push(toUint8Array(item.storageKeys[index]));\n\t\t\t}\n\t\t\tnewAccessList.push([addressBytes, storageItems]);\n\t\t}\n\t\tuint8arrayAccessList = newAccessList;\n\t} else {\n\t\tuint8arrayAccessList = accessList ?? [];\n\t\t// build the JSON\n\t\tconst json: AccessList = [];\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let i = 0; i < uint8arrayAccessList.length; i += 1) {\n\t\t\tconst data = uint8arrayAccessList[i];\n\t\t\tconst address = bytesToHex(data[0]);\n\t\t\tconst storageKeys: string[] = [];\n\t\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\t\tfor (let item = 0; item < data[1].length; item += 1) {\n\t\t\t\tstorageKeys.push(bytesToHex(data[1][item]));\n\t\t\t}\n\t\t\tconst jsonItem: AccessListItem = {\n\t\t\t\taddress,\n\t\t\t\tstorageKeys,\n\t\t\t};\n\t\t\tjson.push(jsonItem);\n\t\t}\n\t\tAccessListJSON = json;\n\t}\n\n\treturn {\n\t\tAccessListJSON,\n\t\taccessList: uint8arrayAccessList,\n\t};\n};\n\nexport const verifyAccessList = (accessList: AccessListUint8Array) => {\n\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\tfor (let key = 0; key < accessList.length; key += 1) {\n\t\tconst accessListItem = accessList[key];\n\t\tconst address = accessListItem[0];\n\t\tconst storageSlots = accessListItem[1];\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n\t\tif ((<any>accessListItem)[2] !== undefined) {\n\t\t\tthrow new Error(\n\t\t\t\t'Access list item cannot have 3 elements. It can only have an address, and an array of storage slots.',\n\t\t\t);\n\t\t}\n\t\tif (address.length !== 20) {\n\t\t\tthrow new Error('Invalid EIP-2930 transaction: address length should be 20 bytes');\n\t\t}\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let storageSlot = 0; storageSlot < storageSlots.length; storageSlot += 1) {\n\t\t\tif (storageSlots[storageSlot].length !== 32) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'Invalid EIP-2930 transaction: storage slot length should be 32 bytes',\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n};\n\nexport const getAccessListJSON = (\n\taccessList: AccessListUint8Array,\n): {\n\taddress: HexString;\n\tstorageKeys: HexString[];\n}[] => {\n\tconst accessListJSON: { address: HexString; storageKeys: HexString[] }[] = [];\n\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\tfor (let index = 0; index < accessList.length; index += 1) {\n\t\tconst item: any = accessList[index];\n\t\tconst JSONItem: { address: HexString; storageKeys: HexString[] } = {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n\t\t\taddress: bytesToHex(setLengthLeft(<Uint8Array>item[0], 20)),\n\t\t\tstorageKeys: [],\n\t\t};\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-assignment, @typescript-eslint/prefer-optional-chain\n\t\tconst storageSlots: Uint8Array[] = item && item[1];\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let slot = 0; slot < storageSlots.length; slot += 1) {\n\t\t\tconst storageSlot = storageSlots[slot];\n\t\t\tJSONItem.storageKeys.push(bytesToHex(setLengthLeft(storageSlot, 32)));\n\t\t}\n\t\taccessListJSON.push(JSONItem);\n\t}\n\treturn accessListJSON;\n};\n\nexport const getDataFeeEIP2930 = (accessList: AccessListUint8Array, common: Common): number => {\n\tconst accessListStorageKeyCost = common.param('gasPrices', 'accessListStorageKeyCost');\n\tconst accessListAddressCost = common.param('gasPrices', 'accessListAddressCost');\n\n\tlet slots = 0;\n\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\tfor (let index = 0; index < accessList.length; index += 1) {\n\t\tconst item = accessList[index];\n\t\tconst storageSlots = item[1];\n\t\tslots += storageSlots.length;\n\t}\n\n\tconst addresses = accessList.length;\n\treturn addresses * Number(accessListAddressCost) + slots * Number(accessListStorageKeyCost);\n};\n"]},"metadata":{},"sourceType":"module"}