{"ast":null,"code":"\"use strict\";\n/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Web3Subscription = void 0; // eslint-disable-next-line max-classes-per-file\n\nconst web3_types_1 = require(\"web3-types\");\n\nconst web3_utils_1 = require(\"web3-utils\");\n\nconst web3_errors_1 = require(\"web3-errors\"); // eslint-disable-next-line import/no-cycle\n\n\nconst web3_subscription_manager_js_1 = require(\"./web3_subscription_manager.js\");\n\nconst web3_event_emitter_js_1 = require(\"./web3_event_emitter.js\");\n\nclass Web3Subscription extends web3_event_emitter_js_1.Web3EventEmitter {\n  constructor(args, options) {\n    var _a;\n\n    super();\n    this.args = args;\n    const {\n      requestManager\n    } = options;\n    const {\n      subscriptionManager\n    } = options;\n\n    if (requestManager && subscriptionManager) {\n      throw new web3_errors_1.SubscriptionError('Only requestManager or subscriptionManager should be provided at Subscription constructor');\n    }\n\n    if (!requestManager && !subscriptionManager) {\n      throw new web3_errors_1.SubscriptionError('Either requestManager or subscriptionManager should be provided at Subscription constructor');\n    }\n\n    if (requestManager) {\n      // eslint-disable-next-line deprecation/deprecation\n      this._subscriptionManager = new web3_subscription_manager_js_1.Web3SubscriptionManager(requestManager, {}, true);\n    } else {\n      this._subscriptionManager = subscriptionManager;\n    }\n\n    this._returnFormat = (_a = options === null || options === void 0 ? void 0 : options.returnFormat) !== null && _a !== void 0 ? _a : web3_types_1.DEFAULT_RETURN_FORMAT;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get lastBlock() {\n    return this._lastBlock;\n  }\n\n  subscribe() {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this._subscriptionManager.addSubscription(this);\n    });\n  }\n\n  processSubscriptionData(data) {\n    var _a, _b;\n\n    if (data === null || data === void 0 ? void 0 : data.data) {\n      // for EIP-1193 provider\n      this._processSubscriptionResult((_b = (_a = data === null || data === void 0 ? void 0 : data.data) === null || _a === void 0 ? void 0 : _a.result) !== null && _b !== void 0 ? _b : data === null || data === void 0 ? void 0 : data.data);\n    } else if (data && web3_utils_1.jsonRpc.isResponseWithNotification(data)) {\n      this._processSubscriptionResult(data === null || data === void 0 ? void 0 : data.params.result);\n    }\n  }\n\n  sendSubscriptionRequest() {\n    return __awaiter(this, void 0, void 0, function* () {\n      this._id = yield this._subscriptionManager.requestManager.send({\n        method: 'eth_subscribe',\n        params: this._buildSubscriptionParams()\n      });\n      this.emit('connected', this._id);\n      return this._id;\n    });\n  }\n\n  get returnFormat() {\n    return this._returnFormat;\n  }\n\n  get subscriptionManager() {\n    return this._subscriptionManager;\n  }\n\n  resubscribe() {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this.unsubscribe();\n      yield this.subscribe();\n    });\n  }\n\n  unsubscribe() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.id) {\n        return;\n      }\n\n      yield this._subscriptionManager.removeSubscription(this);\n    });\n  }\n\n  sendUnsubscribeRequest() {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this._subscriptionManager.requestManager.send({\n        method: 'eth_unsubscribe',\n        params: [this.id]\n      });\n      this._id = undefined;\n    });\n  } // eslint-disable-next-line class-methods-use-this\n\n\n  formatSubscriptionResult(data) {\n    return data;\n  }\n\n  _processSubscriptionResult(data) {\n    this.emit('data', this.formatSubscriptionResult(data));\n  }\n\n  _processSubscriptionError(error) {\n    this.emit('error', error);\n  } // eslint-disable-next-line class-methods-use-this\n\n\n  _buildSubscriptionParams() {\n    // This should be overridden in the subclass\n    throw new Error('Implement in the child class');\n  }\n\n}\n\nexports.Web3Subscription = Web3Subscription;","map":{"version":3,"mappings":"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","names":["Web3Subscription","web3_event_emitter_js_1","constructor","args","options","requestManager","subscriptionManager","web3_errors_1","_subscriptionManager","web3_subscription_manager_js_1","_returnFormat","returnFormat","_a","web3_types_1","id","_id","lastBlock","_lastBlock","subscribe","addSubscription","processSubscriptionData","data","_processSubscriptionResult","result","_b","web3_utils_1","isResponseWithNotification","params","sendSubscriptionRequest","send","method","_buildSubscriptionParams","emit","resubscribe","unsubscribe","removeSubscription","sendUnsubscribeRequest","undefined","formatSubscriptionResult","_processSubscriptionError","error","Error","exports"],"sources":["/home/rupam/Desktop/Faucet-React/node_modules/web3-core/src/web3_subscriptions.ts"],"sourcesContent":["ï»¿/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n// eslint-disable-next-line max-classes-per-file\nimport {\n\tBlockOutput,\n\tDEFAULT_RETURN_FORMAT,\n\tDataFormat,\n\tEthExecutionAPI,\n\tJsonRpcSubscriptionResult,\n\tJsonRpcSubscriptionResultOld,\n\tJsonRpcNotification,\n\tLog,\n\tHexString,\n\tWeb3APIParams,\n\tWeb3APISpec,\n} from 'web3-types';\nimport { jsonRpc } from 'web3-utils';\nimport { SubscriptionError } from 'web3-errors';\n\n// eslint-disable-next-line import/no-cycle\nimport { Web3SubscriptionManager } from './web3_subscription_manager.js';\nimport { Web3EventEmitter, Web3EventMap } from './web3_event_emitter.js';\nimport { Web3RequestManager } from './web3_request_manager.js';\n\ntype CommonSubscriptionEvents = {\n\tdata: unknown; // Fires on each incoming block header.\n\terror: Error; // Fires when an error in the subscription occurs.\n\tconnected: string; // Fires once after the subscription successfully connected. Returns the subscription id.\n};\n\nexport abstract class Web3Subscription<\n\tEventMap extends Web3EventMap,\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tArgsType = any,\n\tAPI extends Web3APISpec = EthExecutionAPI,\n\t// The following generic type is just to define the type `CombinedEventMap` and use it inside the class\n\t// \tit combines the user passed `EventMap` with the `CommonSubscriptionEvents`\n\t//\tHowever, this type definition could be refactored depending on the closure of\n\t//\t[Permit type alias declarations inside a class](https://github.com/microsoft/TypeScript/issues/7061)\n\tCombinedEventMap extends CommonSubscriptionEvents = EventMap & CommonSubscriptionEvents,\n> extends Web3EventEmitter<CombinedEventMap> {\n\tprivate readonly _subscriptionManager: Web3SubscriptionManager<API>;\n\tprivate readonly _lastBlock?: BlockOutput;\n\tprivate readonly _returnFormat: DataFormat;\n\tprotected _id?: HexString;\n\n\tpublic constructor(\n\t\targs: ArgsType,\n\t\toptions: { subscriptionManager: Web3SubscriptionManager; returnFormat?: DataFormat },\n\t);\n\t/**\n\t * @deprecated This constructor overloading should not be used\n\t */\n\tpublic constructor(\n\t\targs: ArgsType,\n\t\toptions: { requestManager: Web3RequestManager<API>; returnFormat?: DataFormat },\n\t);\n\tpublic constructor(\n\t\tpublic readonly args: ArgsType,\n\t\toptions: (\n\t\t\t| { subscriptionManager: Web3SubscriptionManager }\n\t\t\t| { requestManager: Web3RequestManager<API> }\n\t\t) & {\n\t\t\treturnFormat?: DataFormat;\n\t\t},\n\t) {\n\t\tsuper();\n\t\tconst { requestManager } = options as { requestManager: Web3RequestManager<API> };\n\t\tconst { subscriptionManager } = options as { subscriptionManager: Web3SubscriptionManager };\n\t\tif (requestManager && subscriptionManager) {\n\t\t\tthrow new SubscriptionError(\n\t\t\t\t'Only requestManager or subscriptionManager should be provided at Subscription constructor',\n\t\t\t);\n\t\t}\n\t\tif (!requestManager && !subscriptionManager) {\n\t\t\tthrow new SubscriptionError(\n\t\t\t\t'Either requestManager or subscriptionManager should be provided at Subscription constructor',\n\t\t\t);\n\t\t}\n\t\tif (requestManager) {\n\t\t\t// eslint-disable-next-line deprecation/deprecation\n\t\t\tthis._subscriptionManager = new Web3SubscriptionManager(requestManager, {}, true);\n\t\t} else {\n\t\t\tthis._subscriptionManager = subscriptionManager;\n\t\t}\n\n\t\tthis._returnFormat = options?.returnFormat ?? (DEFAULT_RETURN_FORMAT as DataFormat);\n\t}\n\n\tpublic get id() {\n\t\treturn this._id;\n\t}\n\n\tpublic get lastBlock() {\n\t\treturn this._lastBlock;\n\t}\n\n\tpublic async subscribe(): Promise<string> {\n\t\treturn this._subscriptionManager.addSubscription(this);\n\t}\n\n\tpublic processSubscriptionData(\n\t\tdata:\n\t\t\t| JsonRpcSubscriptionResult\n\t\t\t| JsonRpcSubscriptionResultOld<Log>\n\t\t\t| JsonRpcNotification<Log>,\n\t) {\n\t\tif (data?.data) {\n\t\t\t// for EIP-1193 provider\n\t\t\tthis._processSubscriptionResult(data?.data?.result ?? data?.data);\n\t\t} else if (\n\t\t\tdata &&\n\t\t\tjsonRpc.isResponseWithNotification(\n\t\t\t\tdata as unknown as JsonRpcSubscriptionResult | JsonRpcNotification<Log>,\n\t\t\t)\n\t\t) {\n\t\t\tthis._processSubscriptionResult(data?.params.result);\n\t\t}\n\t}\n\n\tpublic async sendSubscriptionRequest(): Promise<string> {\n\t\tthis._id = await this._subscriptionManager.requestManager.send({\n\t\t\tmethod: 'eth_subscribe',\n\t\t\tparams: this._buildSubscriptionParams(),\n\t\t});\n\n\t\tthis.emit('connected', this._id);\n\t\treturn this._id;\n\t}\n\n\tprotected get returnFormat() {\n\t\treturn this._returnFormat;\n\t}\n\n\tprotected get subscriptionManager() {\n\t\treturn this._subscriptionManager;\n\t}\n\n\tpublic async resubscribe() {\n\t\tawait this.unsubscribe();\n\t\tawait this.subscribe();\n\t}\n\n\tpublic async unsubscribe() {\n\t\tif (!this.id) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this._subscriptionManager.removeSubscription(this);\n\t}\n\n\tpublic async sendUnsubscribeRequest() {\n\t\tawait this._subscriptionManager.requestManager.send({\n\t\t\tmethod: 'eth_unsubscribe',\n\t\t\tparams: [this.id] as Web3APIParams<API, 'eth_unsubscribe'>,\n\t\t});\n\t\tthis._id = undefined;\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tprotected formatSubscriptionResult(data: CombinedEventMap['data']) {\n\t\treturn data;\n\t}\n\n\tpublic _processSubscriptionResult(data: CombinedEventMap['data'] | unknown) {\n\t\tthis.emit('data', this.formatSubscriptionResult(data));\n\t}\n\n\tpublic _processSubscriptionError(error: Error) {\n\t\tthis.emit('error', error);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tprotected _buildSubscriptionParams(): Web3APIParams<API, 'eth_subscribe'> {\n\t\t// This should be overridden in the subclass\n\t\tthrow new Error('Implement in the child class');\n\t}\n}\n\nexport type Web3SubscriptionConstructor<\n\tAPI extends Web3APISpec,\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tSubscriptionType extends Web3Subscription<any, any, API> = Web3Subscription<any, any, API>,\n> =\n\t| (new (\n\t\t\t// We accept any type of arguments here and don't deal with this type internally\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\t\targs: any,\n\t\t\toptions:\n\t\t\t\t| { subscriptionManager: Web3SubscriptionManager<API>; returnFormat?: DataFormat }\n\t\t\t\t| { requestManager: Web3RequestManager<API>; returnFormat?: DataFormat },\n\t  ) => SubscriptionType)\n\t| (new (\n\t\t\targs: any,\n\t\t\toptions: {\n\t\t\t\tsubscriptionManager: Web3SubscriptionManager<API>;\n\t\t\t\treturnFormat?: DataFormat;\n\t\t\t},\n\t  ) => SubscriptionType)\n\t| (new (\n\t\t\targs: any,\n\t\t\toptions: { requestManager: Web3RequestManager<API>; returnFormat?: DataFormat },\n\t  ) => SubscriptionType);\n"]},"metadata":{},"sourceType":"script"}