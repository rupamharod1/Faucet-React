{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SendTxHelper = void 0;\n/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\nconst web3_types_1 = require(\"web3-types\");\n\nconst web3_validator_1 = require(\"web3-validator\");\n\nconst web3_errors_1 = require(\"web3-errors\");\n\nconst web3_rpc_methods_1 = require(\"web3-rpc-methods\"); // eslint-disable-next-line import/no-cycle\n\n\nconst get_transaction_gas_pricing_js_1 = require(\"./get_transaction_gas_pricing.js\"); // eslint-disable-next-line import/no-cycle\n\n\nconst try_send_transaction_js_1 = require(\"./try_send_transaction.js\"); // eslint-disable-next-line import/no-cycle\n\n\nconst watch_transaction_for_confirmations_js_1 = require(\"./watch_transaction_for_confirmations.js\");\n\nconst constants_js_1 = require(\"../constants.js\"); // eslint-disable-next-line import/no-cycle\n\n\nconst get_transaction_error_js_1 = require(\"./get_transaction_error.js\"); // eslint-disable-next-line import/no-cycle\n\n\nconst get_revert_reason_js_1 = require(\"./get_revert_reason.js\");\n\nconst decoding_js_1 = require(\"./decoding.js\");\n\nclass SendTxHelper {\n  constructor(_ref) {\n    let {\n      options,\n      web3Context,\n      promiEvent,\n      returnFormat\n    } = _ref;\n    this.options = {\n      checkRevertBeforeSending: true\n    };\n    this.options = options;\n    this.web3Context = web3Context;\n    this.promiEvent = promiEvent;\n    this.returnFormat = returnFormat;\n  }\n\n  getReceiptWithEvents(data) {\n    var _a, _b;\n\n    const result = Object.assign({}, data !== null && data !== void 0 ? data : {});\n\n    if (((_a = this.options) === null || _a === void 0 ? void 0 : _a.contractAbi) && result.logs && result.logs.length > 0) {\n      result.events = {};\n\n      for (const log of result.logs) {\n        const event = (0, decoding_js_1.decodeEventABI)(constants_js_1.ALL_EVENTS_ABI, log, (_b = this.options) === null || _b === void 0 ? void 0 : _b.contractAbi, this.returnFormat);\n\n        if (event.event) {\n          result.events[event.event] = event;\n        }\n      }\n    }\n\n    return result;\n  }\n\n  checkRevertBeforeSending(tx) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.options.checkRevertBeforeSending !== false) {\n        const reason = yield (0, get_revert_reason_js_1.getRevertReason)(this.web3Context, tx, this.options.contractAbi);\n\n        if (reason !== undefined) {\n          throw yield (0, get_transaction_error_js_1.getTransactionError)(this.web3Context, tx, undefined, undefined, this.options.contractAbi, reason);\n        }\n      }\n    });\n  }\n\n  emitSending(tx) {\n    if (this.promiEvent.listenerCount('sending') > 0) {\n      this.promiEvent.emit('sending', tx);\n    }\n  }\n\n  populateGasPrice(_ref2) {\n    let {\n      transactionFormatted,\n      transaction\n    } = _ref2;\n\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function* () {\n      let result = transactionFormatted;\n\n      if (!((_a = this.options) === null || _a === void 0 ? void 0 : _a.ignoreGasPricing) && (0, web3_validator_1.isNullish)(transactionFormatted.gasPrice) && ((0, web3_validator_1.isNullish)(transaction.maxPriorityFeePerGas) || (0, web3_validator_1.isNullish)(transaction.maxFeePerGas))) {\n        result = Object.assign(Object.assign({}, transactionFormatted), yield (0, get_transaction_gas_pricing_js_1.getTransactionGasPricing)(transactionFormatted, this.web3Context, web3_types_1.ETH_DATA_FORMAT));\n      }\n\n      return result;\n    });\n  }\n\n  signAndSend(_ref3) {\n    let {\n      wallet,\n      tx\n    } = _ref3;\n    return __awaiter(this, void 0, void 0, function* () {\n      if (wallet) {\n        const signedTransaction = yield wallet.signTransaction(tx);\n        return (0, try_send_transaction_js_1.trySendTransaction)(this.web3Context, () => __awaiter(this, void 0, void 0, function* () {\n          return web3_rpc_methods_1.ethRpcMethods.sendRawTransaction(this.web3Context.requestManager, signedTransaction.rawTransaction);\n        }), signedTransaction.transactionHash);\n      }\n\n      return (0, try_send_transaction_js_1.trySendTransaction)(this.web3Context, () => __awaiter(this, void 0, void 0, function* () {\n        return web3_rpc_methods_1.ethRpcMethods.sendTransaction(this.web3Context.requestManager, tx);\n      }));\n    });\n  }\n\n  emitSent(tx) {\n    if (this.promiEvent.listenerCount('sent') > 0) {\n      this.promiEvent.emit('sent', tx);\n    }\n  }\n\n  emitTransactionHash(hash) {\n    if (this.promiEvent.listenerCount('transactionHash') > 0) {\n      this.promiEvent.emit('transactionHash', hash);\n    }\n  }\n\n  emitReceipt(receipt) {\n    if (this.promiEvent.listenerCount('receipt') > 0) {\n      this.promiEvent.emit('receipt', // @ts-expect-error unknown type fix\n      receipt);\n    }\n  }\n\n  handleError(_ref4) {\n    let {\n      error,\n      tx\n    } = _ref4;\n\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function* () {\n      let _error = error;\n\n      if (_error instanceof web3_errors_1.ContractExecutionError && this.web3Context.handleRevert) {\n        _error = yield (0, get_transaction_error_js_1.getTransactionError)(this.web3Context, tx, undefined, undefined, (_a = this.options) === null || _a === void 0 ? void 0 : _a.contractAbi);\n      }\n\n      if ((_error instanceof web3_errors_1.InvalidResponseError || _error instanceof web3_errors_1.ContractExecutionError || _error instanceof web3_errors_1.TransactionRevertWithCustomError || _error instanceof web3_errors_1.TransactionRevertedWithoutReasonError || _error instanceof web3_errors_1.TransactionRevertInstructionError) && this.promiEvent.listenerCount('error') > 0) {\n        this.promiEvent.emit('error', _error);\n      }\n\n      return _error;\n    });\n  }\n\n  emitConfirmation(_ref5) {\n    let {\n      receipt,\n      transactionHash\n    } = _ref5;\n\n    if (this.promiEvent.listenerCount('confirmation') > 0) {\n      (0, watch_transaction_for_confirmations_js_1.watchTransactionForConfirmations)(this.web3Context, this.promiEvent, receipt, transactionHash, this.returnFormat);\n    }\n  }\n\n  handleResolve(_ref6) {\n    let {\n      receipt,\n      tx\n    } = _ref6;\n\n    var _a, _b, _c;\n\n    return __awaiter(this, void 0, void 0, function* () {\n      if ((_a = this.options) === null || _a === void 0 ? void 0 : _a.transactionResolver) {\n        return (_b = this.options) === null || _b === void 0 ? void 0 : _b.transactionResolver(receipt);\n      }\n\n      if (receipt.status === BigInt(0)) {\n        const error = yield (0, get_transaction_error_js_1.getTransactionError)(this.web3Context, tx, // @ts-expect-error unknown type fix\n        receipt, undefined, (_c = this.options) === null || _c === void 0 ? void 0 : _c.contractAbi);\n\n        if (this.promiEvent.listenerCount('error') > 0) {\n          this.promiEvent.emit('error', error);\n        }\n\n        throw error;\n      } else {\n        return receipt;\n      }\n    });\n  }\n\n}\n\nexports.SendTxHelper = SendTxHelper;","map":{"version":3,"mappings":"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","names":["SendTxHelper","constructor","options","web3Context","promiEvent","returnFormat","checkRevertBeforeSending","getReceiptWithEvents","data","result","_a","contractAbi","logs","length","events","log","event","constants_js_1","_b","tx","reason","undefined","emitSending","listenerCount","emit","populateGasPrice","transactionFormatted","transaction","ignoreGasPricing","gasPrice","maxPriorityFeePerGas","maxFeePerGas","web3_types_1","signAndSend","wallet","signedTransaction","signTransaction","__awaiter","sendRawTransaction","requestManager","rawTransaction","transactionHash","sendTransaction","emitSent","emitTransactionHash","hash","emitReceipt","receipt","handleError","error","_error","web3_errors_1","handleRevert","emitConfirmation","handleResolve","transactionResolver","status","BigInt","_c","exports"],"sources":["/home/rupam/Desktop/Faucet-React/node_modules/web3-eth/src/utils/send_tx_helper.ts"],"sourcesContent":["/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nimport {\n\tETH_DATA_FORMAT,\n\tFormatType,\n\tDataFormat,\n\tEthExecutionAPI,\n\tTransactionWithSenderAPI,\n\tWeb3BaseWalletAccount,\n\tHexString,\n\tTransactionReceipt,\n\tTransaction,\n\tTransactionCall,\n\tTransactionWithFromLocalWalletIndex,\n\tTransactionWithToLocalWalletIndex,\n\tTransactionWithFromAndToLocalWalletIndex,\n\tLogsInput,\n\tTransactionHash,\n\tContractAbiWithSignature,\n} from 'web3-types';\nimport { Web3Context, Web3EventEmitter, Web3PromiEvent } from 'web3-core';\nimport { isNullish } from 'web3-validator';\nimport {\n\tContractExecutionError,\n\tInvalidResponseError,\n\tTransactionRevertedWithoutReasonError,\n\tTransactionRevertInstructionError,\n\tTransactionRevertWithCustomError,\n} from 'web3-errors';\nimport { ethRpcMethods } from 'web3-rpc-methods';\n\nimport {\n\tSendSignedTransactionEvents,\n\tSendTransactionEvents,\n\tSendTransactionOptions,\n} from '../types.js';\n// eslint-disable-next-line import/no-cycle\nimport { getTransactionGasPricing } from './get_transaction_gas_pricing.js';\n// eslint-disable-next-line import/no-cycle\nimport { trySendTransaction } from './try_send_transaction.js';\n// eslint-disable-next-line import/no-cycle\nimport { watchTransactionForConfirmations } from './watch_transaction_for_confirmations.js';\nimport { ALL_EVENTS_ABI } from '../constants.js';\n// eslint-disable-next-line import/no-cycle\nimport { getTransactionError } from './get_transaction_error.js';\n// eslint-disable-next-line import/no-cycle\nimport { getRevertReason } from './get_revert_reason.js';\nimport { decodeEventABI } from './decoding.js';\n\nexport class SendTxHelper<\n\tReturnFormat extends DataFormat,\n\tResolveType = FormatType<TransactionReceipt, ReturnFormat>,\n\tTxType =\n\t\t| Transaction\n\t\t| TransactionWithFromLocalWalletIndex\n\t\t| TransactionWithToLocalWalletIndex\n\t\t| TransactionWithFromAndToLocalWalletIndex,\n> {\n\tprivate readonly web3Context: Web3Context<EthExecutionAPI>;\n\tprivate readonly promiEvent: Web3PromiEvent<\n\t\tResolveType,\n\t\tSendSignedTransactionEvents<ReturnFormat> | SendTransactionEvents<ReturnFormat>\n\t>;\n\tprivate readonly options: SendTransactionOptions<ResolveType> = {\n\t\tcheckRevertBeforeSending: true,\n\t};\n\tprivate readonly returnFormat: ReturnFormat;\n\tpublic constructor({\n\t\toptions,\n\t\tweb3Context,\n\t\tpromiEvent,\n\t\treturnFormat,\n\t}: {\n\t\tweb3Context: Web3Context<EthExecutionAPI>;\n\t\toptions: SendTransactionOptions<ResolveType>;\n\t\tpromiEvent: Web3PromiEvent<\n\t\t\tResolveType,\n\t\t\tSendSignedTransactionEvents<ReturnFormat> | SendTransactionEvents<ReturnFormat>\n\t\t>;\n\t\treturnFormat: ReturnFormat;\n\t}) {\n\t\tthis.options = options;\n\t\tthis.web3Context = web3Context;\n\t\tthis.promiEvent = promiEvent;\n\t\tthis.returnFormat = returnFormat;\n\t}\n\n\tpublic getReceiptWithEvents(data: TransactionReceipt): ResolveType {\n\t\tconst result = { ...(data ?? {}) };\n\t\tif (this.options?.contractAbi && result.logs && result.logs.length > 0) {\n\t\t\tresult.events = {};\n\t\t\tfor (const log of result.logs) {\n\t\t\t\tconst event = decodeEventABI(\n\t\t\t\t\tALL_EVENTS_ABI,\n\t\t\t\t\tlog as LogsInput,\n\t\t\t\t\tthis.options?.contractAbi as ContractAbiWithSignature,\n\t\t\t\t\tthis.returnFormat,\n\t\t\t\t);\n\t\t\t\tif (event.event) {\n\t\t\t\t\tresult.events[event.event] = event;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result as unknown as ResolveType;\n\t}\n\n\tpublic async checkRevertBeforeSending(tx: TransactionCall) {\n\t\tif (this.options.checkRevertBeforeSending !== false) {\n\t\t\tconst reason = await getRevertReason(this.web3Context, tx, this.options.contractAbi);\n\t\t\tif (reason !== undefined) {\n\t\t\t\tthrow await getTransactionError<ReturnFormat>(\n\t\t\t\t\tthis.web3Context,\n\t\t\t\t\ttx,\n\t\t\t\t\tundefined,\n\t\t\t\t\tundefined,\n\t\t\t\t\tthis.options.contractAbi,\n\t\t\t\t\treason,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic emitSending(tx: TxType | HexString) {\n\t\tif (this.promiEvent.listenerCount('sending') > 0) {\n\t\t\tthis.promiEvent.emit('sending', tx);\n\t\t}\n\t}\n\n\tpublic async populateGasPrice({\n\t\ttransactionFormatted,\n\t\ttransaction,\n\t}: {\n\t\ttransactionFormatted: TxType;\n\t\ttransaction: TxType;\n\t}): Promise<TxType> {\n\t\tlet result = transactionFormatted;\n\t\tif (\n\t\t\t!this.options?.ignoreGasPricing &&\n\t\t\tisNullish((transactionFormatted as Transaction).gasPrice) &&\n\t\t\t(isNullish((transaction as Transaction).maxPriorityFeePerGas) ||\n\t\t\t\tisNullish((transaction as Transaction).maxFeePerGas))\n\t\t) {\n\t\t\tresult = {\n\t\t\t\t...transactionFormatted,\n\t\t\t\t// TODO gasPrice, maxPriorityFeePerGas, maxFeePerGas\n\t\t\t\t// should not be included if undefined, but currently are\n\t\t\t\t...(await getTransactionGasPricing(\n\t\t\t\t\ttransactionFormatted,\n\t\t\t\t\tthis.web3Context,\n\t\t\t\t\tETH_DATA_FORMAT,\n\t\t\t\t)),\n\t\t\t};\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic async signAndSend({\n\t\twallet,\n\t\ttx,\n\t}: {\n\t\twallet: Web3BaseWalletAccount | undefined;\n\t\ttx: TxType;\n\t}) {\n\t\tif (wallet) {\n\t\t\tconst signedTransaction = await wallet.signTransaction(tx);\n\n\t\t\treturn trySendTransaction(\n\t\t\t\tthis.web3Context,\n\t\t\t\tasync (): Promise<string> =>\n\t\t\t\t\tethRpcMethods.sendRawTransaction(\n\t\t\t\t\t\tthis.web3Context.requestManager,\n\t\t\t\t\t\tsignedTransaction.rawTransaction,\n\t\t\t\t\t),\n\t\t\t\tsignedTransaction.transactionHash,\n\t\t\t);\n\t\t}\n\t\treturn trySendTransaction(\n\t\t\tthis.web3Context,\n\t\t\tasync (): Promise<string> =>\n\t\t\t\tethRpcMethods.sendTransaction(\n\t\t\t\t\tthis.web3Context.requestManager,\n\t\t\t\t\ttx as Partial<TransactionWithSenderAPI>,\n\t\t\t\t),\n\t\t);\n\t}\n\n\tpublic emitSent(tx: TxType | HexString) {\n\t\tif (this.promiEvent.listenerCount('sent') > 0) {\n\t\t\tthis.promiEvent.emit('sent', tx);\n\t\t}\n\t}\n\tpublic emitTransactionHash(hash: string & Uint8Array) {\n\t\tif (this.promiEvent.listenerCount('transactionHash') > 0) {\n\t\t\tthis.promiEvent.emit('transactionHash', hash);\n\t\t}\n\t}\n\n\tpublic emitReceipt(receipt: ResolveType) {\n\t\tif (this.promiEvent.listenerCount('receipt') > 0) {\n\t\t\t(\n\t\t\t\tthis.promiEvent as Web3EventEmitter<\n\t\t\t\t\tSendTransactionEvents<ReturnFormat> | SendSignedTransactionEvents<ReturnFormat>\n\t\t\t\t>\n\t\t\t).emit(\n\t\t\t\t'receipt',\n\t\t\t\t// @ts-expect-error unknown type fix\n\t\t\t\treceipt,\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic async handleError({ error, tx }: { error: unknown; tx: TransactionCall }) {\n\t\tlet _error = error;\n\n\t\tif (_error instanceof ContractExecutionError && this.web3Context.handleRevert) {\n\t\t\t_error = await getTransactionError(\n\t\t\t\tthis.web3Context,\n\t\t\t\ttx,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\tthis.options?.contractAbi,\n\t\t\t);\n\t\t}\n\n\t\tif (\n\t\t\t(_error instanceof InvalidResponseError ||\n\t\t\t\t_error instanceof ContractExecutionError ||\n\t\t\t\t_error instanceof TransactionRevertWithCustomError ||\n\t\t\t\t_error instanceof TransactionRevertedWithoutReasonError ||\n\t\t\t\t_error instanceof TransactionRevertInstructionError) &&\n\t\t\tthis.promiEvent.listenerCount('error') > 0\n\t\t) {\n\t\t\tthis.promiEvent.emit('error', _error);\n\t\t}\n\n\t\treturn _error;\n\t}\n\n\tpublic emitConfirmation({\n\t\treceipt,\n\t\ttransactionHash,\n\t}: {\n\t\treceipt: ResolveType;\n\t\ttransactionHash: TransactionHash;\n\t}) {\n\t\tif (this.promiEvent.listenerCount('confirmation') > 0) {\n\t\t\twatchTransactionForConfirmations<\n\t\t\t\tReturnFormat,\n\t\t\t\tSendSignedTransactionEvents<ReturnFormat> | SendTransactionEvents<ReturnFormat>,\n\t\t\t\tResolveType\n\t\t\t>(\n\t\t\t\tthis.web3Context,\n\t\t\t\tthis.promiEvent,\n\t\t\t\treceipt as unknown as TransactionReceipt,\n\t\t\t\ttransactionHash,\n\t\t\t\tthis.returnFormat,\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic async handleResolve({ receipt, tx }: { receipt: ResolveType; tx: TransactionCall }) {\n\t\tif (this.options?.transactionResolver) {\n\t\t\treturn this.options?.transactionResolver(receipt as unknown as TransactionReceipt);\n\t\t}\n\t\tif ((receipt as unknown as TransactionReceipt).status === BigInt(0)) {\n\t\t\tconst error = await getTransactionError<ReturnFormat>(\n\t\t\t\tthis.web3Context,\n\t\t\t\ttx,\n\t\t\t\t// @ts-expect-error unknown type fix\n\t\t\t\treceipt,\n\t\t\t\tundefined,\n\t\t\t\tthis.options?.contractAbi,\n\t\t\t);\n\t\t\tif (this.promiEvent.listenerCount('error') > 0) {\n\t\t\t\tthis.promiEvent.emit('error', error);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t} else {\n\t\t\treturn receipt;\n\t\t}\n\t}\n}\n"]},"metadata":{},"sourceType":"script"}